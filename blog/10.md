# NO.10 NoSQL

**NoSQL**
有时也称作Not Only SQL的缩写，是对不同于传统的关系数据库的数据库管理系统的统称。

NoSQL的实现具有二个特征：使用硬盘，或者把随机存储器作存储载体。

----以上内容来自于维基百科

**一.Memcached**

服务器端主要是安装memcache,用到了libevent这个库用于Socket的处理，所以还需要安装libevent，当然memcache的包都可以yum安装。
```
#1.分别把memcached服务端和libevent库下载回来：
#2.安装libevent
wget -c https://saintic.top/software/nosql/libevent-2.0.21-stable.tar.gz
tar zxf libevent-2.0.21-stable.tar.gz
cd libevent-2.0.21-stable
./configure –prefix=/usr/
make && make install
#测试libevent是否安装成功,有输出说明有了库文件
ls -al /usr/lib | grep libevent

#3.安装memcached，同时需要安装中指定libevent的安装位置：
wget -c https://saintic.top/software/nosql/memcached-1.4.20.tar.gz
tar zxf memcached-1.4.20.tar.gz
cd memcached-1.4.20
./configure –with-libevent=/usr
make && make install

#启动Memcached服务：
/usr/local/bin/memcached -d -u root

#4.注册为系统服务，需要大量修改，不建议使用，可以将启动命令写入rc.local
cp scripts/memcached.sysv /etc/init.d/memcached
cp scripts/memcached-init /etc/sysconfig/memcached
chkconfig --add memcached
chkconfig memcached on
```

**二.MongoDB**

MongoDB默认端口号tcp/27017,如果开启了SELinux,则如下允许:semanage port -a -t mongodb_port_t -p tcp 27017
```
#到官网下载吧
tar zxf mongodb-linux-x86_64-2.6.5.tgz -C /usr/local/
cd /usr/local/
mv mongodb-linux-x86_64-2.6.5/ mongodb
cd mongodb/
mkdir data
touch mongod.logs
./bin/mongod --dbpath=/usr/local/mongodb/data/ --logpath=/usr/local/mongodb/mongod.logs --logappend --fork &

#创建配置文件mongod.conf，没有开启WT(3.0版本后可以开启，参考https://github.com/staugur/CoreWeb)
dbpath = /usr/local/mongodb/data
logpath = /usr/local/mongodb/mongod.logs
logappend = true
port = 27017
fork = true
auth = true
#以后启动可以用mongod –f mongod.conf启动
#查看有没有在监听
netstat -anptl | grep mongod
tcp        0      0 0.0.0.0:27017               0.0.0.0:*                   LISTEN      6236/mongod
```

**三.Redis**

1：下载redis

下载地址 http://redis.io/download

推荐下载latest最新版，http://125.39.35.146/files/1096000006FD69AB/download.redis.io/releases/redis-3.0.5.tar.gz

2：安装redis

下载后解压 tar zxvf redis-3.0.5.tar.gz 到任意目录，例如/usr/local/redis-3.0.5

解压后，进入redis目录
```
    cd /usr/local/redis-3.0.5
    make  ```

拷贝文件

cp redis.conf /etc/ #这个文件是redis启动的配置文件
cp redis-benchmark redis-cli redis-server /usr/bin/ #这个倒是很有用，加入PATH，这样就不用再执行时加上./了，而且可以在任何地方执行

设置内存分配策略（可选，根据服务器的实际情况进行设置）

/proc/sys/vm/overcommit_memory， 可选值：0、1、2。

0， 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。

1， 表示内核允许分配所有的物理内存，而不管当前的内存状态如何。

2， 表示内核允许分配超过所有物理内存和交换空间总和的内存

处理防火墙

    ```iptables -I INPUT -p tcp --dport 6379 -j ACCEPT  ```

重新加载规则
    service iptables restart   

3：启动redis服务
    [root@Architect redis-1.2.6]# pwd  
    /usr/local/redis-1.2.6  
    [root@Architect redis-1.2.6]# redis-server /etc/redis.conf  

查看进程，确认redis已经启动

    [root@Architect redis-1.2.6]# ps -ef | grep redis  
    root       401 29222  0 18:06 pts/3    00:00:00 grep redis  
    root     29258     1  0 16:23 ?        00:00:00 redis-server /etc/redis.conf  

如果这里启动redis服务失败，一般情况下是因为redis.conf文件有问题，建议检查或找个可用的配置文件进行覆盖，避免少走弯路，这里建议，修改redis.conf，设置redis进程为后台守护进程

    # By default Redis does not run as a daemon. Use 'yes' if you need it.  
    # Note that Redis will write a pid file in /var/run/redis.pid when daemonized.  
    daemonize yes  

4：测试redis
    [root@Architect redis-1.2.6]# redis-cli  
    redis> set name songbin  
    OK  
    redis> get name   
    "songbin"  

5：关闭redis服务
    redis-cli shutdown  

redis服务关闭后，缓存数据会自动dump到硬盘上，硬盘地址为redis.conf中的配置项dbfilename dump.rdb所设定
强制备份数据到磁盘，使用如下命令

    redis-cli save 或者 redis-cli -p 6380 save（指定端口）


