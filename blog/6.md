# NO.6 LAMP,Apache+MySQL+PHP

系统环境：LINUX-CentOS 6.5 64Bit, 关闭SELinux！

以下命令以root身份执行（#号代表root），若有相应权限sudo亦可。

**一.Apache(可直接第三步安装)**

下载软件：wget -c https://saintic.top/software/web/Apache.zip
```
yum -y install libxml2-devel libtool pcre-devel ncurses-devel bison-devel gcc-c++ gcc make cmake expat-devel zlib-devel gd-devel libcurl-devel bzip2-devel readline-devel libedit-devel perl neon-devel openssl-devel mysql wget telnet unzip cyrus-sasl-devel php-mbstring php-bcmath gettext-devel libxslt-devel```

1>【安装apr】
```
tar zxf apr-1.2.12.tar.gz
cd apr-1.2.12
./configure –enable-shared
make && make install```

2>【安装apr-util】
```
tar zxf apr-util-1.2.12.tar.gz
cd apr-util-1.2.12
./configure –enable-shared –with-expat=builtin –with-apr=/usr/local/apr/
make && make install```

3>【安装apache】

官方下载链接： http://mirror.bit.edu.cn/apache//httpd/httpd-2.2.29.tar.gz
```
tar zxf httpd-2.2.29.tar.gz
cd httpd-2.2.29
./configure –prefix=/usr/local/apache/ –sysconfdir=/etc/httpd –enable-mods-shared=most –enable-modules=most –enable-so –enable-rewrite=shared –enable-ssl=shared –with-ssl –enable-cgi –enable-dav –with-included-apr –with-apr=/usr/local/apr/bin/apr-1-config –with-apr-util=/usr/local/apr/bin/apu-1-config –enable-static-support –enable-charset-lite
make && make install
cp /usr/local/apache/bin/apachectl /etc/init.d/httpd //创建apache服务脚本
echo “#chkconfig: – 85 15” >> /etc/init.d/httpd
echo “#description: Apache HTTP Server” >> /etc/init.d/httpd
chkconfig –add httpd ; chkcondfig htpd on
sed -i “s/#ServerName www.example.com:80/ServerName ${HOSTNAME}/g” /etc/httpd/httpd.conf
service httpd start```

**二.MySQL**

Mysql5.5安装https://saintic.top/software/web/mysql-5.5.20.tar.gz

以下配置打开了InnoDB引擎，若不需要请在cmake时去掉”-DWITH_INNOBASE_STORAGE_ENGINE=1″或将其值设为0！
```
useradd -M -s /sbin/nologin -u 27 mysql
tar zxf mysql-5.5.20.tar.gz
cd mysql-5.5.20/
cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_EXTRA_CHARSETS=all -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/usr/local/mysql/data/ -DMYSQL_USER=mysql -DMYSQL_TCP_PORT=3306
make && make install
cp support-files/my-medium.cnf /etc/my.cnf
chown -R mysql:mysql /usr/local/mysql
/usr/local/mysql/script/mysql_install_db –basedir=/usr/local/mysql –datadir=/usr/local/mysql/data –user=mysql
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld
chkconfig –add mysqld
chkconfig mysqld on
service mysqld start```

**三：部署PHP**

链接地址：wget -c https://saintic.top/software/web/php.zip
```
unzip php.zip
#先安装libmcrpt、mhash、mcrypt等扩展工具库,数据加密工具libmcrypt、mhash、mcrypt
tar zxf libmcrypt-2.5.7.tar.gz -C /usr/src/
cd /usr/src/libmcrypt-2.5.7/
./configure && make && make install
ln -s /usr/local/lib/libmcrypt.* /usr/lib64/ //64Bit系统需要做

tar zxf mhash-0.9.2.tar.gz -C /usr/src/
cd /usr/src/mhash-0.9.2/
./configure && make && make install
ln -s /usr/local/lib/libmhash* /usr/lib64/ //64Bit系统需要做

tar zxf mcrypt-2.6.4.tar.gz -C /usr/src/
cd /usr/src/mcrypt-2.6.4/
./configure && make && make install

tar jxf php-5.4.33.tar.bz2
cd php-5.4.33
./configure –prefix=/usr/local/php –with-config-file-path=/etc –with-apxs2=/usr/local/apache/bin/apxs –with-mysql=/usr/local/mysql/ –with-mysqli=/usr/local/mysql/bin/mysql_config –with-iconv –with-freetype-dir –with-jpeg-dir –with-png-dir –with-zlib –with-libxml-dir –enable-xml –enable-sysvsem –enable-sysvshm –enable-inline-optimization –with-curl –enable-fpm –with-fpm-user=nginx –with-fpm-group=nginx –enable-mbstring –with-mhash –with-mcrypt –with-gd –enable-gd-native-ttf –with-openssl –enable-sockets –with-pdo-mysql –enable-pdo –enable-zip –enable-soap –enable-ftp –enable-shmop –with-bz2 –enable-exif –with-gettext –enable-bcmath –with-xsl –enable-mysqlnd
make ; make test ; make install

#配置 PHP
cp php.ini-production /etc/php.ini
cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf
cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm
chmod +x /etc/init.d/php-fpm
chkconfig –add php-fpm
chkconfig php-fpm on

#为Apache修改配置:
vim /etc/httpd/httpd.conf
#在AddType application/x-gzip .gz .tgz下一行添加
AddType application/x-httpd-php .php
#修改DirectoryIndex index.html行，在其后加index.php
#保存退出```

**四、测试**
#vim $APACHE_HOME/htdocs/info.php     //PHP信息
<?php
Phpinfo();
?>

#vim $APACHE_HOME/htdocs/mysql.php     //PHP连接MySQL
<?php
$link = mysqli_connect(‘localhost’, ‘root’, ”, ‘test’);
if($link) echo “MySQL connected!”;
?>